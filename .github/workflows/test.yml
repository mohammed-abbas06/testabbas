name: Pass Output Between Jobs

on:
  workflow_dispatch:
    inputs:
      environment_name:
        description: 'enter the environment'
        required: true

jobs:
  checks_user_permission:
    runs-on: ubuntu-latest
      
    steps:
    - name: Check if the user has permission to deploy
      if: ${{ contains(fromJSON('["stg", "prod"]'), github.event.inputs.environment_name) || contains(fromJSON('["user1", "user2","mohammed-abbas06"]'), github.actor) }}
      run: |
        echo "the user does not have permission"
        exit 1
  
  job1:
    needs: checks_user_permission
    runs-on: ubuntu-latest
    outputs:
      step1-output: ${{ steps.step1.outputs.github_env }}

    steps:
      - name: Step 1
        id: step1
        run: |
          if echo "${{ github.event.inputs.environment_name }}" | grep -Eq '^dev[1-9]$'; then
            echo "input_env=dev" 
            github_env="dev"
          else
            echo "input_env=${{ github.event.inputs.environment_name }}"
            github_env=${{ github.event.inputs.environment_name }}
          fi
          echo "github_env=$github_env" >> $GITHUB_OUTPUT

  job2:
    needs: job1
    runs-on: ubuntu-latest

    steps:
      - name: Step 2
        run: |
          # Use the output from Job 1 in Job 2
          echo "Received output: ${{ needs.job1.outputs.step1-output }}"

name: ems_po_legacy_service
run-name: ${{ github.actor }} triggered ems po legacy service stack deploy

on:
  workflow_dispatch:
    inputs:
      environment_name:
        description: 'enter the environment'
        required: true
      branch_name:
        description: 'enter the bitbucket branch name'
        required: true
      commit_id:
        description: 'enter bitbucket commit id'
      tag_version:
        description: 'enter the tag version'

permissions:
  id-token: write
  contents: read
  
env:
  prod_deploy: false
  validStgProdDeployUsers: 'madhessekar,Bharathr1,mohammed-abbas06,Mohamed-Kalandar-Sulaiman-S' 

jobs: 
  sam_deployment:
    runs-on: ubuntu-latest
    if: ${{ env.prod_deploy == 'true' }}
    steps:
    - name: Set Environment
      id: set_env
      run: |
        if echo "${{ github.event.inputs.environment_name }}" | grep -Eq '^dev[1-9]$'; then
          echo "env=dev"
          github_env="dev"
        elif echo "${{ github.event.inputs.environment_name }}" | grep -Eq 'sw'; then
          echo "got it"
          env=${{ github.event.inputs.environment_name }}
          echo "${env//-sw}"
        else
          echo "env=${{ github.event.inputs.environment_name }}"
          github_env=${{ github.event.inputs.environment_name }}
        fi
        echo "github_env=$github_env" >> $GITHUB_OUTPUT


